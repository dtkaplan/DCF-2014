---
output:
  html_document:
    css: ~/KaplanFiles/DCF-2014/CSS/DCF-style.css
    fig_caption: yes
    toc: no
---

```{r child="/Users/kaplan/KaplanFiles/DCF-2014/CSS/DCF-common.Rmd"}
```

<!--- Control the display of answers -->
<style>
  aside.answer {color:white; background-color:blue; display:none;}
</style>


## Week 4

### Functions and their roles

Identify each of these functions as either a **Data Verb**, a **Transformation**, a **Summary Function**, or a **Quick Presentation** or a **Comparison Expression**.

* `str()` <aside class="answer"> Quick presentation</aside>
* `group_by()` <aside class="answer"> Data verb</aside>
* `rank()` <aside class="answer"> Transformation</aside>
* `mean()` <aside class="answer"> Summary Function</aside>
* `filter()` <aside class="answer"> Data Verb</aside>
* `summary()`  <aside class="answer">Quick presentation </aside>
* `summarise()` <aside class="answer">Data verb</aside>
* `anti_join()` <aside class="answer">Data verb</aside>
* `merge()` <aside class="answer">Data verb</aside>
* `glimpse()` <aside class="answer">Quick presentation</aside>

### Diamonds

These questions refer to the `diamonds` data table.  Take a look at the codebook (using `help()`) so that you'll understand the meaning of the tasks.^[Motivated by [this problem set](http://www.public.iastate.edu/~hofmann/stat480/homework/dplyr%20drills.html) based on drills by Garrett Grolemund.]  Write, using paper and pen, an expression that will answer these questions.


* What's the largest diamond depth observed for each clarity group?
* What color of diamond is most common for each of the different cuts?

### Output from Summarising

Imagine a data table, `Patients`, with categorical variables `name`, `diagnosis`, `sex`, and quantitative variable `age`.

You have a statement in the form
```
Patients %>%
  group_by(  some variables ) %>%
  summarise( count=n(), meanAge=mean(age) )
```

Replacing <code>some variables</code> with each of the following, say ...   

* what variables will appear in the output
* whether `meanAge` will contain any new information.

#. `sex`
#. `diagnosis`
#. `sex`, `diagosis`
#. `age`, `diagnosis`
#. `age`



### Wide and Narrow

Here are three data tables with the same information:
```{r cache=TRUE, echo=FALSE}
set.seed(102)
Big <-
  BabyNames %>% 
  filter( count > 500 )
theseNames <-  unique(Big %>% sample_n(size=10))[["name"]] %>% head( 3 )
One <- 
  BabyNames %>%
  filter( name %in% theseNames, year %in% c(1912,2012)) %>%
  group_by( name, sex, year ) %>%
  summarise( nbabies=sum(count) ) %>% arrange(year)  %>% tail(10)
Two <- One %>%
  spread( key=sex, value=nbabies )
Three <- One %>% 
  spread( key=year, value=nbabies )
Four <- One %>%
  spread( key=name, value=nbabies)
options( xtable.NA.string = "NA" )
Five <- spread(Four, key=sex, value=year )
```

<style>
td, th {
    padding: 3px;
}
tr  {
    vertical-align: "top";
    padding: 15px;
    border-collapse: collapse;
}
</style>
</head>

<body>
<table border=1>
 <caption>The same data presented in three versions</caption> 
  <tr> 
    <th>Version One</th><th>Version Two</th><th>Version Three</th>
  </tr>
  <tr>
    <td>
```{r echo=FALSE,results='asis'}
xtable(One)
```
    </td>
    <td>
```{r echo=FALSE,results='asis'}
xtable(Two)
```
    </td> 
    <td>
```{r echo=FALSE,results='asis'}
xtable(Three)
```
    </td>
 </tr>
</table>
 
#. What is the meaning of a case in each of the tables?
    * Version One
    * Version Two
    * Version Three
#. Comparing Version One to Version Two, which table is narrow and which one is wide?  
#. What "key" variable from the narrow table is being used?
#. There are no `NA`s in Version One, but there are in Versions Two and Three.  Why?
#. Version Two has 6 cases, while Version 3 has only 5 cases.  How can they contain the same information?
#. Version Three was "spread" from Version One.  What variable was used to denote the spread columns?
#. Version One can be created by gathering columns from Version Two.    
    * Which variables from Two were gathered into One?  
    * What "key" variable, not explicitly named in Version Two, does appear in Version One?
    * Where where the values taken from Version Two to use as levels in the key variable created for Version One? 
* Suppose you want to create the following table with the name of the most popular name of either sex each year
    ```{r echo=FALSE}
One %>%
  group_by( year, sex ) %>% 
  filter( rank( nbabies )==1)
```
    What should the chain of commands look like to make this from Table One?
* Suppose you want to calculate the ratio of male to female in each name in each year.  Like this:
    ```{r echo=FALSE}
Two %>% 
  mutate( ratio=F/M) %>%
  select( name, year, ratio )

```
    * Would you rather start from Version Two or Version Three?
    * If you were given Version One, would you rather work directly on that with the data verbs or, first, translate to one of the other forms? 
```{r child="../CSS/DisqusTemplate.Rmd"}
```
