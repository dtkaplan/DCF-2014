
```{r include=FALSE}
require(DCF)
require(mosaic)
require(dplyr)
require(ggplot2)
require(tidyr)
require(ScoreR)
require(NHANES)
require(knitr)
```

```{r include=FALSE}
opts_chunk$set( echo=FALSE, message=FALSE, out.width="60%",
                warning=FALSE)
```

## Week 5

### One

This and several following problems concern the `NHANES` data.

Judging from the graph, what's the most likely height among the `NHANES` people? (FYI: The heights are in meters.)


```{r}
ggplot( data=NHANES, aes( x=height )) + 
  geom_density(color="gray",fill="black", alpha=.4)
```

### Two

What's the most likely height for women?  For men?

```{r}
ggplot( data=NHANES, aes( x=height, color=sex )) + 
  geom_density(aes(fill=sex), alpha=.4)
```

### Three

Here's the density for `bmi` and `age` simultaneously.  The blue lines play the role of contours on a contour map of geography.

```{r}
pp <-
  filter( NHANES, age>=25, age<80) %>%
  ggplot( aes( x=age, y=bmi )) + 
  geom_point( alpha=.03, position="jitter" ) +
    geom_density2d( alpha=.4, color="red", size=1) +
  ylim(17,42)
```

What's the most likely BMI for a 40-year old?  For a 70-year old?

### Four

```{r}
ZD<-
  ZipDemography %>% sample_n( size=20000 ) %>% 
  filter( X65yearsandover > 0) %>%
  mutate( renters=Occupiedhousingunits/Totalhousingunits,
          kids=Under5years/Totalpopulation,
          elderly=X65yearsandover/Totalpopulation,
          balance=kids/elderly ) %>%
  filter( elderly < 0.50 )
```

You're doing a study of whether grandparents go where the grandkids are.  As a first attempt, you look at 20 ZIP codes.  You find the relationship between the fraction of people in a ZIP code under 5 years old and the fraction 65 and older,  plotted below.


```{r} 
set.seed(111)
ZD %>%  sample_n(size=20) %>%
  ggplot( aes( x=100*kids,y=100*elderly )) +
  geom_point( alpha=.3, position="jitter" ) +
  stat_smooth(method='lm') +
  ylim(0,40) + xlim(0,15) + xlab("Fraction under 5") + 
  ylab("Fraction 65 and older")
```

* Do the data indicate that ZIP codes with high elderly populations tend to have high child populations?

* Looking at the confidence bands, is your data possibly consistent with there being no relationship (that is, a level line) between elderly population and child population?

You decide to get more data: study 80 ZIP codes.  Here's the result.

```{r}
set.seed(111)
ZD %>%  sample_n(size=80) %>%
  ggplot( aes( x=100*kids,y=100*elderly )) +
  geom_point( alpha=.3, position="jitter" ) +
  stat_smooth(method='lm') +
  ylim(0,40) + xlim(0,15) + xlab("Fraction under 5") + 
  ylab("Fraction 65 and older")
```

* Is a flat line consistent with the data?

* Compare the height of the confidence band with 20 ZIP codes to the height of the band with 80 ZIP codes: 4 times as much data in the larger sample than the smaller.  Roughly, what's the ratio of confidence band heights?

* Statistical theory indicates that the width of a confidence band  based on $n$ points goes as $1/\sqrt{n}$.  Does this seem about right?

### Five

Studying a sample of 100 ZIP codes, the following graphic divides ZIP codes into 5 income groups, looking at the fraction of the population that is 65 and older.  

```{r}
set.seed(102)
DD <- ZD %>% 
  mutate( 
    incomeGroup=ntiles(Medianhouseholdincomedollars,5, 
                       format="median"))
DD %>% sample_n( size=100 ) %>%
  ggplot( aes( x=incomeGroup,y=100*elderly )) +
  geom_boxplot( aes(group=incomeGroup), outlier.colour="gray",notch=TRUE,fill=NA ) +
  geom_point(alpha=.1) + ylab("Fraction 65 and older")
```


What relationship do you see between income and the fraction of the population greater than 65? (The notch shows the confidence interval on the median population.)


The same analysis, but for a sample 16 times as big as before.

```{r}
DD %>% sample_n( size=1600 ) %>%
  ggplot( aes( x=incomeGroup,y=100*elderly )) +
  geom_boxplot( aes(group=incomeGroup), outlier.colour="gray",notch=TRUE,fill=NA ) +
  geom_point(alpha=.025)  + ylab("Fraction 65 and older")
```

Do the notch sizes (confidence intervals) follow the $1/\sqrt{n}$ rule?


```{r child="../CSS/DisqusTemplate.Rmd"}
```

