---
title: "Assignment for Week Three"
author: "Data and Computing Fundamentals"
date: "Macalester College"
output:
  html_document:
    css: ~/KaplanFiles/DCF-2014/CSS/DCF-style.css
    fig_caption: yes
    toc: yes
---

```{r child="/Users/kaplan/KaplanFiles/DCF-2014/CSS/DCF-common.Rmd"}
```


## Birds at the Ordway Nature Reserve

Here's part of a data table showing how many times birds of each species appear in the `OrdwayBirds` data.  Construct a statement that generates this table.

```{r echo=FALSE}
OrdwayBirds %>% 
  group_by( SpeciesName ) %>%
  summarise( count=n() ) %>% 
  arrange( desc(count) ) %>% head()
```

In fact, many of the listings in the `OrdwayBirds` data have mis-spelled species names, the result of errors in entering the data.  Often these are trivial mis-spellings that are easy to correct.  The `OrdwaySpeciesNames` table contains a list of mis-spellings and the corrected spelling.  Here's a part of it:

```{r echo=FALSE}
Tmp <- OrdwaySpeciesNames[c(66,79,140,160,187),]
row.names(Tmp) <- NULL
Tmp
```

Use `OrdwaySpeciesNames` along with `OrdwayBirds` to produce a corrected count of species.  It will look like this:

```{r echo=FALSE,message=FALSE}
OrdwayBirds %>% 
  inner_join(OrdwaySpeciesNames) %>%
  group_by( SpeciesNameCleaned ) %>%
  summarise( count=n() ) %>% 
  arrange( desc(count) ) %>% head()
```

Finally, create a table, like this, that shows which species are miscounted the most if the mis-spelled species names are used in the count.

```{r echo=FALSE,message=FALSE}
MisCounted <- 
  OrdwayBirds %>% 
  group_by( SpeciesName ) %>%
  summarise( origCount=n() ) 
CorrectlyCounted <- 
  OrdwayBirds %>% 
  inner_join(OrdwaySpeciesNames) %>%
  group_by( SpeciesNameCleaned ) %>%
  summarise( correctedCount=n() ) %>%
  mutate( SpeciesName=SpeciesNameCleaned ) %>% select(-SpeciesNameCleaned )
CorrectlyCounted %>% 
  inner_join(MisCounted) %>%
  mutate( fractionWrong=(correctedCount-origCount)/correctedCount ) %>%
  arrange( desc(fractionWrong) ) %>%
  select( -fractionWrong ) %>% head()
```


## Review

* CVC/Summer2014/Activities/NCI60.Rmd.  There's only one join operation in the thing, but that's why the topic is in this week rather than week 3.

## Join  

Biblical names: get a list of bible-related names, join these with BabyNames so that there's a biblical column.  How have biblical names gone up or down over the years.

Standardizing country codes: See the CVC/Summer2014 exercise: WorldPop.Rmd

Disasters --- join with population data to produce a risk factor for each state.

### Entropy of Baby Names

Turn each name count into a fraction for that year.  Then calculate the entropy over time for boys and girls separately.

```{r}
Entropy <- BabyNames %>%
  group_by( sex, year ) %>%
  mutate( frac=count/sum(count) ) %>%
  ungroup() %>%
  group_by( sex, year ) %>% 
  summarise( entropy=sum( -frac*log2(frac)))
```

Plot it out:
```{r}
ggplot( Entropy, aes(x=year, y=entropy, group=sex, color=sex ) ) +
  geom_line( )
```

Higher entropy corresponds to a greater diversity of names.  An entropy of 7 is equivalent to $2^7 = 128$ different names, each of equal likelihood.  An entropy of 10 is equivalent to $2^{10} = 1024$ different names.

### Arrange within group_by()

Or maybe it should be one of the rank functions in filter.

Within each precinct, which ward had the largest number of votes?  (Hint: Make a data table with the number of votes in each `Precinct` `Ward` combination.  Arrange this by `Precinct` and the number of votes.)

